<html>
    <head><title>Heroine Dawn</title></head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
    <style>
        .input_buttons {
            padding:25px !important;
            background-color: rgb(80, 80, 80);
            color:white;
            -webkit-border-fit:border !important;
        }
        .input_buttons_lesser {
            padding:15px !important;
        }
        a {
            color:darkgrey;
        }
    </style>
    <body style="color:white; background-color:black;">
        <br/>
        <center>
            <canvas id="main_canvas" width="160" height="120" style="width:95%;max-width: 840px;"></canvas>
            <br/>
            <input type="button" class="input_buttons" value="  &hookleftarrow;  " onclick="dawnGame.doInput('left');" />
            <input type="button" class="input_buttons" value="  &uarr;  " onclick="dawnGame.doInput('up');"  />
            <input type="button" class="input_buttons" value="  &hookrightarrow;  " onclick="dawnGame.doInput('right');" />
            <br/>
            <input type="button" class="input_buttons input_buttons_lesser" value="  â‰¡  " onclick="dawnGame.doInput('menu');" />
            <p id="main_status" style="height:40px;display: none;" >Loading...</p>
        </center>
        <br/>
        <hr/>
        <div>
            <font style="color:darkgray">
                <a href="../"><b>Heroine Dawn</b> [about/guide]</a>
                <a id="main_save_link" href="">[...]</a>
            
            <br/>
                <i><p id="main_intro_note"></p></i>
            </font>
        </div>
        <script src="scripts/things.js"></script>
        <script src="scripts/game.js"></script>
        <script src="scripts/render.js"></script>
        <script src="scripts/swipe.js"></script>
        <script src="scripts/utils.js"></script>
        <script>
            function main_init() {
                dawnUtils.downloadJson("world.json", (world) => {
                    main_status.innerHTML = "Loaded.";
                    dawnGame.initFromWorld(world);
                    dawnGame.callOnChanged.push(() => {updatePageLink();});
                    loadPageParameters();
                    dawnRenderer.initFromGameWorld(dawnGame, world, main_canvas, main_status);
                    dawnSwipe.setupSwipes(dawnGame, main_canvas, main_status);
                    dawnRenderer.redraw();

                    var msg = "";
                    for (var i in world.intro_note) {
                        msg += world.intro_note[i] + "<br/>";
                    }
                    main_intro_note.innerHTML = msg;
                });
            }
            var pageParams = [ "map_id", "x", "y", "facing" ];
            function setupPageParam(params, name) {
                var val = params.get(name);
                if (val == undefined) return;
                if (!isNaN(val)) {
                    val = 1*val;
                }
                dawnGame.state.avatar[name] = val;
            }
            function loadPageParameters() {
                var queryString = window.location.search;
                var urlParams = new URLSearchParams(queryString);
                for (var i in pageParams) {
                    setupPageParam(urlParams, pageParams[i]);
                }
            }
            function updatePageLink() {
                var path = "?";
                for (var i in pageParams) {
                    var name = pageParams[i];
                    if (i != 0) {
                        path += "&";
                    }
                    path += name + "=" + dawnGame.state.avatar[name];
                }
                main_save_link.href = path;
            }
            main_init();
        </script>

    </body>
</html>