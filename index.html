<html>
    <head><title>Heroine Dawn - Game Page</title></head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        a { color:rgb(170, 170, 170); }
    </style>
    <body style="color:white; background-color:black;">
        <div>
            <center>
                
                <h1>Heroine Dawn</h1>
                <a href="web/index.html">
                    <img src="web/images/backgrounds/nightsky.png"/><br/>
                    <h1 style="color:white;">Play...</h1>
                </a>
            </center>
        </div>
        <div>
            <h3>About</h3>
            <p>Play a heroine from chapel floor to early fame!</p>
            <p>Based on the original <a href="http://heroinedusk.com/">Heroine Dusk</a> 
                by <a href="https://clintbellanger.net/">Clink Bellanger</a>. </p>
        </div>
        <div>
            <h3>World Guide</h3>
            <script src="web/scripts/utils.js"></script>
            <script src="web/scripts/topdown_render.js"></script>
            <pre id="topdown_whole"></pre>
            <h3>Map Explorer</h3>
                <p>Click doors to explore and see details below:</p>
            <div id="topdown_main_div"></div>
            <pre id="topdown_info"></pre>
            <script>
                var topdownWorld = null;
                var topdownMap = 1;
                var topdownGuideTitle = "world";
                var topdownGuideFocus = null;
                function topdownThingClicked(thing) {
                    if (thing.type == "exit") {
                        topdownMap = thing.dest_map;
                        redrawTopdown();
                    }
                }
                function topdownMapTileClicked(map_id,x,y) {
                    var world = topdownWorld;
                    var map = world.maps[map_id];
                    for (var i in map.things) {
                        var thing = map.things[i];
                        if ((thing.x == x) && (thing.y == y)) {
                            topdownThingClicked(thing);
                        }
                    }
                }
                function clickedGuideText(name) {
                    topdownGuideTitle = "world." + name;
                    var obj = dawnUtils.parsePath(topdownWorld, name);
                    topdownGuideFocus = obj;
                    redrawTopdown();
                }
                function buildGuideText(title,obj) {
                    if (title == "world") {
                        var ans = "";
                        var finalArray = [];
                        var delayList = { avatar:true, backgrounds:true, tile_types:true };

                        for (var i in obj) {
                            var name = i; //obj[i];
                            if (i == "equipment") {
                                for (var j in obj[name]) {
                                    var path = "equipment." + j;
                                    finalArray.push(path);
                                }
                                continue;
                            }
                            if ((i == "summary")) {
                                continue;
                            }
                            if (i in delayList) {
                                continue;
                            }
                            finalArray.push(name);
                        }
                        for (var i in delayList) {
                            finalArray.push(i);
                        }
                        for (var i in finalArray) {
                            var path = finalArray[i];
                            var name = path.replace("equipment.","");
                            ans += "   <u style='cursor:pointer;' onclick=\"clickedGuideText('" + path + "')\" >" + name + "</u>\n";
                        }
                        return ans;
                    }
                    if (!obj) {
                        obj = dawnUtils.parsePath({world:topdownWorld}, title);
                        console.assert(obj);
                    }
                    if (Array.isArray(obj)) {
                        var ans = "";
                        for (var i in obj) {
                            ans += buildGuideText(title + "[" + i + "]", obj[i] );
                        }
                        return ans;
                    }

                    var world = topdownWorld;
                    var ans = "";
                    if (obj.name) ans += "<u>" + obj.name + "</u>\n";
                    if (obj.background) {
                        ans += "<img src='web/" + world.backgrounds[obj.background].src + "' />\n"
                    }
                    if (title.startsWith("world.equipment.treasures")) {
                        var tId = obj.index;
                        var tData = world.rendering.treasures;
                        var xoffset = tId * tData.icon_width;
                        ans += dawnTopDownRenderer.createCroppedImage('web/' + tData.src, xoffset, 0, tData.icon_width, tData.icon_height) + "\n";
                    }
                    if (title.startsWith("world.equipment.armors")) {
                        var tId = obj.index;
                        var tData = world.rendering.avatar;
                        var xoffset = tId * tData.width;
                        ans += dawnTopDownRenderer.createCroppedImage('web/' + tData.src, xoffset, tData.armor_src_y, tData.width, tData.height) + "\n";
                    }
                    if (title.startsWith("world.equipment.weapons")) {
                        var tId = obj.index;
                        var tData = world.rendering.avatar;
                        var xoffset = tId * tData.width;
                        ans += dawnTopDownRenderer.createCroppedImage('web/' + tData.src, xoffset, tData.weapon_src_y, tData.width, tData.height) + "\n";
                    }
                    if (obj.topdown_src) {
                        ans += "<img src='web/" + obj.topdown_src + "' style='width:32px' />\n"
                    }
                    if (obj.src) {
                        ans += "<img src='web/" + obj.src + "' />\n"
                    }
                    if (obj.image_src) {
                        ans += "<img src='web/" + obj.image_src + "' />\n"
                    }

                    ans += "" + title + " : ";
                    ans += dawnUtils.customJsonStringify(obj);
                    ans += "\n";
                    ans += "<br/>";

                    if (obj.things) {
                        for (var i in obj.things) {
                            var thing = obj.things[i];
                            if (thing.type == "person") {
                                ans += buildGuideText( "world.people[" + thing.person_id + "]" );
                            }
                            if (thing.type == "chest") {
                                ans += buildGuideText( "world.equipment.treasures[" + thing.treasure_id + "]" );
                            }
                            if (thing.type == "enemy") {
                                ans += buildGuideText( "world.enemies[" + thing.enemy_id + "]" );
                            }
                        }
                    }
                    if (obj.enemies && obj.background) {
                        for (var i in obj.enemies) {
                            var ei = obj.enemies[i];
                            ans += buildGuideText( "world.enemies[" + ei + "]"  );
                        }
                    }
                    if (title.startsWith("world.people")) {
                        for (var i in obj.item) {
                            var item = obj.item[i];
                            if (item.type == "weapon") {
                                ans += buildGuideText( "world.equipment.weapons[" + item.value + "]"  );
                            }
                            if (item.type == "armor") {
                                ans += buildGuideText( "world.equipment.armors[" + item.value + "]"  );
                            }
                            if (item.type == "spell") {
                                ans += buildGuideText( "world.equipment.spells[" + item.value + "]"  );
                            }
                        }
                    }

                    var showTileTypes = false;
                    if (showTileTypes && obj.tiles) {
                        var types = {};
                        for (var y=0; y<obj.height; y++) {
                            for (var x=0; x<obj.width; x++) {
                                var tt = obj.tiles[y][x];
                                if (!(tt in types)) {
                                    types[tt] = true;
                                    ans += buildGuideText("world.tile_types[" + tt + "]");
                                }
                            }
                        }

                    }

                    return ans;
                }
                function redrawTopdown() {
                    if (!topdownWorld) return;
                    topdown_main_div.innerHTML = dawnTopDownRenderer.createMapHtmlString(topdownWorld, topdownMap,"topdownMapTileClicked");
                    topdown_info.innerHTML = buildGuideText("world.maps[" + topdownMap + "]");

                    var guideText = buildGuideText("world", topdownWorld);
                    if (topdownGuideFocus) {
                        guideText += "<br/>\n";
                        guideText += buildGuideText(topdownGuideTitle, topdownGuideFocus);
                    }
                    topdown_whole.innerHTML = guideText;
                }
                function initMap() {
                    dawnUtils.downloadJson("web/world.json", (world) => {
                        topdownWorld = world;
                        redrawTopdown();
                    });
                }
                initMap();
            </script>
        </div>
        <div>
            <h3>Credits</h3>
            <p><i>
Heroine Dawn was adapted by Lewey Geselowitz <a href="http://lewcid.com/">http://lewcid.com</a><br/>
Heroine Dusk is created by Clint Bellanger <a href="http://clintbellanger.net">http://clintbellanger.net</a><br/>
Heroine Dusk features music by Yubatake <a href="http://opengameart.org/users/yubatake">http://opengameart.org/users/yubatake</a> </i></p>
        </div>
        <div>
            <h3>Development</h3>
            <p>While looking for a fun game to write, I stumbled across Heroine Dusk, and 
                like many others appreciated both the clarity of content and the clean code and
                data design. While trying to <a href="https://github.com/leweyg/heroine_dawn">adapt it</a> 
                into a different game (Heroine Dawn), I felt that re-organizing the code to be
                more data centric would be appropraite, and so have exported most of the game
                content into a <a href="https://github.com/leweyg/heroine_dawn/blob/main/web/world.json">single JSON file</a>.
                This file is shown below:
                <code>TODO: visualize world.json here...</code>
            </p>
        </div>
    </body>
</html>